= DjVutool =

'''DjVutool''' je shellov√Ω skript urƒçen√Ω konverzi bitmapov√Ωch sken≈Ø do DjVu soubor≈Ø a k pr√°ci s nimi v prost≈ôed√≠ GNU/Linux. 

Pro pr√°ci s textem vyu≈æ√≠v√° standardn√≠ch n√°stroj≈Ø<ref>awk, sed, vim</ref> ale vyu≈æ√≠v√° i dal≈°√≠ open source n√°stroje:

* utility z '''DjVuLibre'''<ref>[http://sourceforge.net/projects/djvu DjVuLibre]</ref>
* enk√≥dovac√≠ utilitu didjvu<ref>[http://jwilk.net/software/didjvu didjvu] - autor Jakub Wilk</ref>
* OCR nadstavbu '''ocrodjvu'''<ref>[http://jwilk.net/software/ocrodjvu ocrodjvu] - autor Jakub Wilk</ref>
* konverzn√≠ n√°stroje z bal√≠ku '''ImageMagick'''<ref>[http://www.imagemagick.org ImageMagick]</ref>
* XML command line toolkit  '''xmlstarlet'''<ref>[http://xmlstar.sourceforge.net xmlstarlet]</ref>

S jeho pomoc√≠ lze:

* Generovat DjVu soubory z bitmapov√Ωch sken≈Ø ulo≈æen√Ωch do r≈Øzn√Ωch form√°t≈Ø
* P≈ôid√°vat nov√© str√°nky do DjVu svazk≈Ø
* P≈ôesouvat str√°nky v r√°mci DjVu svazku
* Odstra≈àovat str√°nky z DjVu svazku
* Exportovat a importovat data skryt√© textov√© vrstvy i cel√© DjVu str√°nky z DjVu svazk≈Ø
* Editovat obsah (''outline'') a meta atributy DjVu soubor≈Ø

Po vyexportov√°n√≠ obsahu skryt√© textov√© vrstvy lze pou≈æ√≠t pro dal≈°√≠ zpracov√°n√≠ obsahu pou≈æ√≠t javascriptov√Ω editor '''WebDjVuTextEd'''<ref>[http://sourceforge.net/projects/webdjvutexted WebDjVuTextEd] autor Ferenc Veres</ref>, a upraven√© XML soubory importovat zpƒõt.

Pro vytvo≈ôen√≠ hyperlink≈Ø je vhodn√Ωm n√°strojem  '''djvusmooth'''<ref>[http://jwilk.net/software/djvusmooth djvusmooth] - autor Jakub Wilk</ref>.

== Pou≈æit√≠ ==
P≈ôi konverzi bitmapov√©ho souboru do DjVu:

 djvutool [volby] <bitmapov√Ω sken> [ /cesta ]

P≈ôi pr√°ci s DjVu soubory:

 djvutool [volby] <DjVu soubor> {akce} [ ... ]

=== Jak p≈ôed√°vat data ===
Vzhledem k tomu, ≈æe se v djvu souborech mohou vyskytovat i str√°nky s opakovan√Ωmi mezerami, je t≈ôeba na to pamatovat p≈ôi pr√°ci na p≈ô√≠kazov√© ≈ô√°dce a v takov√©m p≈ô√≠padƒõ pou≈æ√≠t znak '\' (''backslash'')

== Konverze bitmapov√Ωch soubor≈Ø ==
Konverze bitmapov√Ωch sken≈Ø prob√≠h√° tak, ≈æe se nejprve vyexportuj√≠ jednotliv√© vrstvy jako samostatn√© str√°nky ve form√°tu PNG do adres√°≈ôe s n√°zvem souboru bez p≈ô√≠pony, a ty se postupnƒõ konvertuj√≠ podle nastaven√Ωch voleb do DjVu form√°tu.

T√≠mto zp≈Øsobem lze zkonvertovat v√≠cevrstv√© soubory do formy, kter√° umo≈æ≈àuje jejich sestaven√≠ do DjVu svazku.

== Vytvo≈ôen√≠ DjVu svazku z konvertovan√Ωch soubor≈Ø ==
P≈ô√≠klad:

 djvutool soubor.xcf

Nejprve se zalo≈æ√≠ adres√°≈ô s n√°zvem soubor, do kter√©ho vysype jednotliv√© vrstvy ze souboru soubor.xcf jako bitmapov√© soubory ve form√°tu PNG

 soubor/-soubor-000.png
       |-soubor-001.png
       ....

A tyto soubory n√°slednƒõ na z√°kladƒõ p≈ôedan√Ωch voleb zpracuje do DjVu..

 soubor/-soubor-000.png
       |-soubor-000.djvu
       |-soubor-001.png
       |-soubor-001.djvu
       ....



== Volby ==
Pomoc√≠ voleb lze nastavit, co v≈°e m√° b√Ωt p≈ôedmƒõtem zpracov√°n√≠ bƒõhem akce
=== -a|--algorithm ===
Volbou algoritmu, kter√Ω se m√° pou≈æ√≠t pro vytvo≈ôen√≠ masky, lze ovlivnit v√Ωsledek separace obrazov√© vrstvy DjVu dokumentu. Nen√≠-li touto volbou urƒçeno jinak, pou≈æije se v√Ωchoz√≠ algoritmus ''djvu'', ale proto≈æe se v√Ωsledek m≈Ø≈æe znaƒçnƒõ li≈°it, podle typu p≈ôedlohy, znaƒçnƒõ li≈°it, je mo≈æn√© nastavit i v√≠ce algoritm≈Ø a pomoc√≠ akce '''test''' prov√©st testovac√≠ konverzi p≈ôedlohy.

=== -d|--dsed ===

=== --dpi ===

=== -f|--force ===

=== --clean|--lossy|--lossless|--level ===

=== -i|--image ===

=== -m|--meta ===

=== -o|--ocr ===
Je volba, kter√° umo≈æ≈àuje p≈ôedat utilitƒõ [[ocrodjvu]] k√≥dy jazyk≈Ø, se kter√Ωmi se m√° pracovat p≈ôi OCR zpracov√°n√≠ skryt√© textov√© vrstvy

=== -p|--page ===
P≈ôi akci '''export''' a '''import''' 

=== -r|--rename ===
Nastaven√≠ vzoru pro pojmenov√°n√≠ str√°nek p≈ôi akc√≠ch '''rename''', '''fore''' a '''back'''

=== -t|--thumb ===

=== -v|--verbose ===

=== -x|--xml ===

== Akce ==

=== delete ===
Akce je urƒçena pro odstra≈àov√°n√≠ DjVu str√°nek z DjVu svazku

=== edit ===
Akce urƒçena pro p≈ô√≠mou editaci obsahu meta atribut≈Ø a z√°lo≈æek v r√°mci DjVu svazku.

Pro nep≈ô√≠mou editaci (formou √∫pravy vyexportovan√Ωch soubor≈Ø) jsou urƒçeny akce export a import

=== export, import ===
Akce pro export a import je urƒçena pro extrakci str√°nek, jejich n√°hled≈Ø, meta informac√≠ a obsahu skryt√© textov√© vrstvy DjVu svazku.

=== fore, back ===
Akce pro p≈ôesun a import DjVu str√°nek

=== printmeta, setmeta ===
Akce pro v√Ωpis a nastaven√≠ meta atribut≈Ø DjVu str√°nek a svazk≈Ø

=== info ===
Akce pro v√Ωpis informac√≠ o DjVu souboru

=== rename ===
Akce pro p≈ôejmenov√°n√≠ str√°nek DjVu svazku podle zvolen√©ho vzoru

=== rotate ===
Akce pro zmƒõnu v√Ωchoz√≠ho natoƒçen√≠ DjVu str√°nek

== Funkce v DjVuTool ==
Konvence:
	export - funkce kter√© prov√°d√≠ extrakci
	print  - funkce kter√© vypisuj√≠ na konzoli
	import - funkce kter√© vkl√°daj√≠ do souboru



:* changemeta
:* comparedjvu
	''potvrdit''
#+ convertimg
:* deletepage
	''identifybundle''
	''identifypage''
:* djvuexport
	''targetdir''
	''identifypage''
	''identifyname''
	''dsedtooutline''
#+ djvuimport
:* djvuinfo
	''djvuexport''
	''identifybundle''
	''identifyname''
	''identifypage''
	''lastpage''
#+ djvumove
:* djvurotate
	''identifybundle''
	''potvrdit''
::* dsedtooutline
::* encode
::* escape_path
::* exportdjvuall
	''exportdjvupage''
		''pushd''
		''popd''
		''potvrdit''
	''exportdsedpage''
		''pushd'
		''popd'''
		''potvrdit''
	''exportxmlpage''
		''pushd''
		''popd''
		''identifypage''
		''potvrdit''
	''exportdsedbundle''
		''pushd''
		''popd''
		''potvrdit''
	''exportxmlbundle''
		''pushd''
		''popd''
		''potvrdit''
	''identifyname''
	''identifypage''
	''targetdir''
	''exportimgpage''
		''pushd''
		''popd''
		''identifypage''
		''potvrdit''
:::* exportdjvupage
	''pushd''
	''popd''
	''potvrdit''
:::* exportdsedbundle
	''pushd''
	''popd''
	''potvrdit''
:::* exportdsedpage
	''pushd''
	''popd''
	''potvrdit''
:::* exportimgpage
	''pushd''
	''popd''
	''identifypage''
	''potvrdit''
#+ exportmetabundle
#+ exportmetapage
#-:* exportoutline
#-	''help''
:::* exportxmlbundle
	''pushd''
	''popd''
	''potvrdit''
:::* exportxmlpage
	''pushd''
	''popd''
	''identifypage''
	''potvrdit''
::* filetodjvu
	''todjvu''
		''testfile''
		''potvrdit''
			''getocr''
::* getocr
:* help
::* identifybundle
	''testfile''
::* identifyname
::* identifypage
:* import
	''list''
	''importdsedpage''
	''importxmlpage''
	''importmetapage''
	''importmetaall''
	''importoutline''
		''tabs''
::* importdsedpage
::* importmetaall
::* importmetapage
::* importoutline
	''tabs''
::* importxmlpage
:* lastpage
:* list
:* log
* main
	''help''
	''log''
	''testfile''
	''deletepage''
		''identifybundle''
			''testfile''
		''identifypage''
	'''todjvu'''
	'''insertpage'''
	''djvumove''
		''identifypage''
		''identifyname''
		''exportdjvupage''
		''deletepage''
			''identifybundle''
			''identifypage''
		''comparedjvu''
			''potvrdit''
		''filetodjvu''
			''todjvu''
				''testfile''
				''potvrdit''
				''getocr''
	''djvurotate''
		''identifybundle''
			''testfile''
		''potvrdit''
		''identifyname''
	''djvuexport''
		'':targetdir''
		''identifyname''
		''identifypage''
		''exportdjvuall''
			''exportoutline''
				''help''
	''djvuimport''
		''list''
		''importdsedpage''
		''importxmlpage''
		''importmetapage''
		''importmetaall''
		''importoutline''
	''djvuinfo''
		''djvuexport''
		''identifybundle''
		''identifyname''
		''identifypage''
		''lastpage''
	''printmeta''
		''lastpage''
		''identifyname''
		''identifypage''
	''printoutline''
		''dsedtooutline''
	''setmeta''
		''lastpage''
		''printmeta''
			''lastpage''
			''identifyname''
			''identifypage''
	''outlineset''
		''xtabs''
		''outlinetodsed''
		''encode''
	''unsetmeta''
		''lastpage''
		''printmeta''
			''lastpage''
			''identifyname''
			''identifypage''
	'''outlinetodsed'''
	''changemeta''
#	''exportoutline''
#		''help''
:* djvumove
	''identifypage''
	''identifyname''
	''exportdjvupage''
		''identifybundle''
		''identifypage''
	''filetodjvu''
		''todjvu''
			''testfile''
			''potvrdit''
			''getocr''
:* outlineset
	''xtabs''
	''outlinetodsed''
	''encode''
:::* popd
::* potvrdit
:* printant
	''identifybundle''
	''formatdsed''
	''identifyname''
		''identifybundle''
	''range''
:* printmeta - nahrazeno printant
	''lastpage''
	''identifyname''
	''identifypage''
:* printoutline
	''dsedtooutline''
:::* pushd
:* setmeta
	''lastpage''
	''printmeta''
::* tabs
::* targetdir
:* testfile
:::* todjvu
	''testfile''
	''potvrdit''
	''getocr''
# todjvuclassic
# todotest
# todoview
:* unsetmeta
	''lastpage''
	''printmeta''
		''lastpage''
		''identifyname''
		''identifypage''
::* xtabs

= INFO =

Info o DjVu souboru..
indirect svazek
: exiftool nevypisuje meta atributy svazku i jeho str√°nek
: neuv√°d√≠ nic o velikosti str√°nek, rozli≈°en√≠
: uv√°d√≠ jen typ 'DJVU (multi-page'

bundle svazek
: exiftool vypisuje metaatributy 
: uv√°d√≠ subfiletype

Single page uv√°d√≠ jen DJVU

Mƒõlo by vypsat tyto informace..

#1 {jm√©no str√°nky} <orientation> <resolution> <size> 


= Jak vytvo≈ôit obsah (outline) =

N√°stroje z DjVuLibre umo≈æ≈àuj√≠ obsah DjVu svazku vyexportovat pouze v dsed form√°tu, proto tato utilita prov√°d√≠ p≈ôi importu a exportu jeho konverzi do l√©pe editovateln√© formy.

== Pojmenov√°n√≠ souboru s obsahem ==
U souboru s obsahem svazku se p≈ôedpokl√°d√°, ≈æe m√° stejn√Ω n√°zev, jako DjVu svazek, pouze s t√≠m rozd√≠lem, ≈æe m√° m√≠sto ''.djvu'' p≈ô√≠ponu ''.outline''

Je to obyƒçejn√Ω textov√Ω soubor, kter√Ω lze editovat libovoln√Ωm textov√Ωm editorem.

POZOR na tabel√°tory!!!  Pro √∫rove≈à zano≈ôen√≠ polo≈æky obsahu se toti≈æ pou≈æ√≠v√° odsazen√≠ pomoc√≠ mezer, a p≈ôi pou≈æit√≠ znaku TAB (\t) m√≠sto mezer by do≈°lo k chybn√© interpretaci souboru p≈ôi jeho importu do svazku.

Polo≈æka obsahu je v≈ædy tvo≈ôena dvƒõma textov√Ωmi ≈ôetƒõzci, uzav≈ôen√Ωmi v jednoduch√Ωch z√°vork√°ch

 "Popis obsahu" "c√≠lov√° str√°nka"

; Popis obsahu : je text, kter√Ω se vygeneruje jako polo≈æka obsahu v prohl√≠≈æeƒçi
; c√≠lov√° str√°nka : je buƒè n√°zev, nebo po≈ôadov√© ƒç√≠slo str√°nky v DjVu svazku, na kterou polo≈æka obsahu odkazuje. Aby nebylo nutn√© obsah opravovat po ka≈æd√© zmƒõnƒõ v po≈ôad√≠ str√°nek, je lep≈°√≠ z praktick√©ho hlediska v≈ædy pou≈æ√≠vat n√°zev c√≠lov√© str√°nky, m√≠sto jej√≠ho aktu√°ln√≠ho po≈ôad√≠.

Pozn√°mka: Po≈ôadov√©ho ƒç√≠slo je v≈ædy uvozeno znakem '#' (m≈ô√≠≈æka)

Nejrychlej≈°√≠m zp≈Øsob, jak z√≠skat z√°klad pro vytvo≈ôen√≠ obsahu DjVu svazku, je pou≈æ√≠t akci outline

outline order

"" "#1"
"" "#2"
...

outline name

"" "page1.djvu"
"" "page2.djvu"
...

outline print

Vyp√≠≈°e st√°vaj√≠c√≠ obsah na konzoli

outline dump

Vyexportuje st√°vaj√≠c√≠ obsah v dsed form√°tu

U str√°nek na kter√© m√° polo≈æka obsahu odkazovat p≈ôidat popisek
Vno≈ôen√≠ obsahu - odsazen√≠ mezerami, nebo tabul√°torem

A
B
C

je-li odsazen√≠ vƒõt≈°√≠, ne≈æ u p≈ôedchoz√≠ polo≈æky, dojde k zano≈ôen√≠ o dal≈°√≠ √∫rove≈à
A
  B
    C

je-li odsazen√≠ men≈°√≠, dojde k vyvo≈ôen√≠ √∫rovnƒõ..
A
 B
  C
 D

je-li hodnota odsazen√≠ stejn√°
	uzav≈ô√≠t p≈ôedchoz√≠ polo≈æku
	nastavit LEVEL na hodnotu odsazen√≠

je-li hodnota odsazen√≠ vƒõt≈°√≠
	neuzav√≠rat p≈ôedchoz√≠ polo≈æku
	nav√Ω≈°it LEVEL na hodnotu odsazen√≠

je-li hodnota odsazen√≠ men≈°√≠ o jednu jednotku..
	uzav≈ô√≠t p≈ôedchoz√≠ polo≈æku
	odeƒç√≠st jeden LEVEL
	uzav≈ô√≠t polo≈æku
	a zkontrolovat je-li LEVEL po odeƒçten√≠ na hodnotƒõ odsazen√≠..

hodnota odsazen√≠ - poƒçet mezer podle √∫rovnƒõ levelu
p≈ôi navy≈°ov√°n√≠ hodnoty odsazen√≠ pro LEVEL - (
p≈ôi sni≈æov√°n√≠ hodnoty odsazen√≠ pro LEVEL )
p≈ôi stejn√© hodnotƒõ odsazen√≠ mezery

LEVEL=0
IFS=''
while read line ; do
	NEW="${line##+( )}" && echo "${NEW}"
	TAB="${line%${NEW}}" && echo "${#TAB}"
	if [ "${#LEVEL}" -eq "${#TAB}" ] ; then
		# Odsazen√≠ se nemƒõn√≠
		echo ") ("${line}
	elif [ "${#LEVEL}" -gt "${#TAB}" ] ; then
		# Odsazen√≠ se zmen≈°ilo.. O kolik?
		COUNT=0
		while [ "${#LEVEL}" -gt "${#TAB}" ] ; then
			COUNT=$((COUNT+1))
			LEVEL=${LEVEL%${TAB}}
		done
		# 
		printf '%.s)' {0..${COUNT}} && echo '( '${line}
	else
		# Tady se m≈Ø≈æe odsazen√≠ pouze zvƒõt≈°it..
		# Odsazen√≠ se zvƒõt≈°ilo.. O kolik?
		COUNT=0
		while [ "${#TAB}" -gt "${#LEVEL}" ] ; then
			COUNT=$((COUNT+1))
			LEVEL="${LEVEL}${TABS}"
		done
		# 
		printf '%.s(' {0..${COUNT}} && echo ${line}
	fi
done < test1.outline


(A -- LEVEL=0
  (B -- LEVEL=1
    (C -- LEVEL=2
   )(D -- LEVEL=3
)


Import upraven√©ho obsahu do DjVu str√°nky
========================================

Obsah skryt√© textov√© vrstvy je ulo≈æen do dvou z√°kladn√≠ch oblast√≠:

ant
---
Obsahuje meta atributy, pozn√°mky, k obsahu, aktivn√≠ oblasti (hyperlinky)
obsah (outline - bookmarks)

txt
---
Obsahuje textov√Ω obsah

Pro √∫pravu textov√©ho obsahu je vhodn√Ω javascriptov√Ω editor ..., kter√Ω pracuje s XML souborem.
Obsah (outline, bookmarks, z√°lo≈æky) lze vytvo≈ôit p≈ôes Djvusmooth) a nebo ho naimportovat ze souboru


[1mN√°povƒõda..

Vlo≈æen√≠ znaku ESC - Ctrl+Shift+u
Form√°tov√°n√≠ v√Ωstupu
ESC[<ƒç√≠slo>m

 convertor - je konzolov√° nadstavba nad standardn√≠mi n√°stroji pro pr√°ci
             s DjVu a dal≈°√≠mi utilitami.

Co um√≠?

  * odstra≈àovat str√°nky z DjVu svazku na z√°kladƒõ jejich jm√©na nebo po≈ôad√≠
  * p≈ôesouvat DjVu str√°nky v r√°mci svazku
  * vkl√°dat do DjVu svazku str√°nky z nov√Ωch soubor≈Ø
  * konvertovat bitmapov√© soubory do djvu s aplikac√≠ OCR
  * exportovat a importovat textovou vrstvu DjVu str√°nek 
  * dekompletovat a kompletovat DjVu svazek
  * p≈ôeƒç√≠slov√°vat a p≈ôejmenov√°vat str√°nky DjVu souboru na z√°kladƒõ vzorku


[3mPou≈æit√≠ ${0##/}:

 ${0##/} [volby] {vzorek|dir/|name} docin.djvu

[1mParametry:
    docin.djvu - vstupn√≠ djvu dokument se kter√Ωm se m√° pracovat
    dir/       - jm√©no adres√°≈ôe se li≈°√≠ od jm√©na ƒçi vzorku lom√≠tkem 
    vzorek     - ≈ôetƒõzec, kter√Ωm se maj√≠ vyselektovat soubory s nimi≈æ se
                 m√° pracovat - je to ƒç√°st jm√©na souboru, kter√° p≈ôedch√°z√≠
                 jeho po≈ôadov√©mu ƒç√≠slu

Volby: 
  -h|--help     N√°povƒõda
  -f|--force
  -i|--indirect V√Ωsledekm zpracov√°n√≠ bude voln√Ω svazek
  -b|--bundle   V√Ωsledekm zpracov√°n√≠ bude kompaktn√≠ svazek ( default)
  -d|--dsed P≈ôi pr√°ci s textovou vrstvou se bude pracovat s form√°tem
              dsed (lisp)
  -x|--xml  P≈ôi pr√°ci s textovou vrstvou se bude pracovat s form√°tem
              xml

Parametrick√© volby:
   -n|--name    parametr zajist√≠, ≈æe se soubory p≈ôejmenuj√≠
   -r|--rename  ≈ôetƒõzec, kter√Ω se m√° pou≈æ√≠t k pojmenov√°n√≠ soubor≈Ø m√≠sto 
                st√°vaj√≠c√≠ch n√°zv≈Ø soubor≈Ø p≈ôi sestaven√≠ svazku 
                soubor_0000 - soubor_0001.djvu .. soubor_0123.djvu
                soubor_0 -    soubor_1.djvu ,, soubor_123.djvu

Rozbalen√≠ do voln√©ho svazku:

$0 [volby] dirname/ [index.djvu] [name] docin.djvu

    dirname/ - jm√©no adres√°≈ôe, kter√Ω nemus√≠ existovat
    docin.djvu - vstupn√≠ DjVu soubor (mus√≠ existovat)

Sbalen√≠ do svazku:

$0 [volby] index.djvu bundle.djvu

    bundle.djvu - jm√©no c√≠lov√©ho svazku (nemus√≠ existovat)

Vytvo≈ôen√≠ nov√©ho svazku:

$0 [volby] vzor docout.djvu

    vzor - nesm√≠ odpov√≠dat jm√©nu existuj√≠c√≠ho adres√°≈ôe nebo souboru
    docout.djvu - jm√©no c√≠lov√©ho djvu svazku (typ urƒçuje volba)
    -b - 
    -i - voln√Ω svazek
    -n - parametr zajist√≠, ≈æe se soubory p≈ôejmenuj√≠

Svazek sestavuje z djvu soubor≈Ø s n√°zvem vyhovuj√≠c√≠m vzorku. P≈ô√≠klad:

    $0 -i test novysoubor.djvu

Vyhled√° soubory test-1.djvu, test-2.djvu, ... a sestav√≠ do voln√©ho svazku
s indexov√Ωm souborem novysoubor.djvu.

Pokud je uveden parametr -n, budou d√≠lƒç√≠ dokumenty p≈ôejmenov√°ny tak, aby
odpov√≠daly n√°zvu svazku: novysoubor-001.djvu, novysoubor-002.djvu, ...

= FAQ =

== meta ==
Funkce zpracov√°vaj√≠ obsah elementu (metadata ... ) v pozn√°mk√°ch (ant)

== ostatn√≠ data
maparea
	url "" ""
	"xxxxxx"
	rect
		<ƒçty≈ôi sou≈ôadnice>
	border
		<barva v RGB>
	border_avis
	hilite
		<barva v RGB>
